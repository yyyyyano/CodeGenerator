{% extends "base.html" %}

{% block title %}Генератор кода - CodeGen AI{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/generator_style.css') }}">
{% endblock %}

{% block content %}
<div class="main-content">
    <div class="page-header">
        <h1>Генератор кода</h1>
        <p class="page-subtitle">Сгенерируйте код по описанию задачи с использованием AI</p>
    </div>

    <div class="user-info-banner">
        <p>Вы вошли как: <strong>{{ full_name or username }}</strong> • Роль: <span class="role-badge">{{ role }}</span> • Сессия: <span class="session-status active">активна</span></p>
    </div>

    <div class="template-info-banner" id="templateInfoBanner" style="display: none;">
        <div class="template-info-header">
            <h3><i class="fas fa-cube"></i> Используется шаблон: <span id="templateName"></span></h3>
            <button class="close-template-btn" id="closeTemplateBtn">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <p id="templateDescription"></p>
        <div class="template-tags">
            <span class="template-tag" id="templateLanguageTag"></span>
            <span class="template-tag" id="templateFrameworkTag"></span>
            <span class="template-tag" id="templateCategoryTag"></span>
        </div>
    </div>

    <section class="generator-section">
        <form id="generatorForm">
            <div class="form-grid">
                <div class="form-left">
                    <div class="input-group">
                        <label for="requirement">
                            <i class="fas fa-edit"></i> Описание задачи
                        </label>
                        <textarea id="requirement" name="requirement" 
                                  placeholder="Опишите задачу, которую нужно реализовать..." 
                                  rows="6"></textarea>
                        <div class="char-count">
                            <span id="charCount">0</span> / 1000 символов
                        </div>
                    </div>

                    <div class="prompt-suggestions">
                        <h4><i class="fas fa-lightbulb"></i> Подсказки для описания:</h4>
                        <ul>
                            <li>Четко опишите входные и выходные данные</li>
                            <li>Укажите требования к производительности</li>
                            <li>Опишите структуру данных, если необходимо</li>
                            <li>Укажите ограничения и условия</li>
                        </ul>
                    </div>
                </div>

                <div class="form-right">
                    <div class="settings-group">
                        <h3><i class="fas fa-cog"></i> Настройки генерации</h3>
                        
                        <div class="setting">
                            <label for="language">
                                <i class="fas fa-code"></i> Язык программирования
                            </label>
                            <select id="language" name="language">
                                <option value="Python">Python</option>
                                <option value="JavaScript">JavaScript</option>
                                <option value="TypeScript">TypeScript</option>
                                <option value="Java">Java</option>
                                <option value="C++">C++</option>
                                <option value="Go">Go</option>
                                <option value="Rust">Rust</option>
                            </select>
                        </div>

                        <div class="setting">
                            <label for="framework">
                                <i class="fas fa-layer-group"></i> Фреймворк
                            </label>
                            <select id="framework" name="framework">
                                <option value="None">Без фреймворка</option>
                                <option value="React">React</option>
                                <option value="Vue.js">Vue.js</option>
                                <option value="Express">Express</option>
                                <option value="Django">Django</option>
                                <option value="Flask">Flask</option>
                                <option value="Spring">Spring</option>
                            </select>
                        </div>

                        <div class="setting">
                            <label for="role">
                                <i class="fas fa-user-tie"></i> Роль для генерации
                            </label>
                            <select id="role" name="role">
                                <option value="DEVELOPER">Разработчик</option>
                                <option value="SYSTEM_ANALYST">Системный аналитик</option>
                                <option value="STUDENT">Студент</option>
                            </select>
                        </div>

                        <div class="setting checkbox-setting">
                            <label>
                                <input type="checkbox" id="addComments" name="addComments" checked>
                                <i class="fas fa-comments"></i> Добавить комментарии в код
                            </label>
                        </div>

                        <div class="setting checkbox-setting">
                            <label>
                                <input type="checkbox" id="optimizeCode" name="optimizeCode">
                                <i class="fas fa-bolt"></i> Оптимизировать код
                            </label>
                            <span class="hint">(только для роли Разработчик)</span>
                        </div>
                    </div>

                    <div class="actions">
                        <button type="submit" class="generate-btn" id="generateBtn">
                            <i class="fas fa-magic"></i>
                            Сгенерировать код
                        </button>
                        <button type="button" class="clear-btn" id="clearBtn">
                            <i class="fas fa-eraser"></i>
                            Очистить
                        </button>
                    </div>
                </div>
            </div>
        </form>
    </section>

    <section class="code-section">
        <div class="section-header">
            <h2><i class="fas fa-file-code"></i> Сгенерированный код</h2>
            <div class="code-actions">
                <button class="action-btn" id="copyBtn">
                    <i class="fas fa-copy"></i> Копировать
                </button>
                <button class="action-btn" id="downloadBtn">
                    <i class="fas fa-download"></i> Скачать
                </button>
                <button class="action-btn" id="formatBtn">
                    <i class="fas fa-indent"></i> Форматировать
                </button>
                <button class="action-btn" id="themeToggleBtn">
                    <i class="fas fa-palette"></i> Сменить тему
                </button>
            </div>
        </div>

        <div class="code-container">
            <div class="code-header">
                <span id="fileName">generated_code.py</span>
                <span class="language-badge" id="languageBadge">Python</span>
            </div>
            <pre id="codeOutput" class="code-output"><code>// Здесь появится сгенерированный код</code></pre>
        </div>

        <div class="status-container" id="statusContainer">
            <div class="status-header">
                <h4><i class="fas fa-info-circle"></i> Статус генерации</h4>
                <span class="status-indicator idle" id="statusIndicator">Готов</span>
            </div>
            <div class="status-details" id="statusDetails">
                Ожидание ввода данных...
            </div>
        </div>
    </section>

    <section class="history-section">
        <div class="section-header">
            <h2><i class="fas fa-history"></i> Недавние генерации</h2>
            <button class="clear-history-btn" id="clearHistoryBtn" title="Очистить всю историю">
                <i class="fas fa-trash"></i> Очистить историю
            </button>
        </div>
        <div class="history-grid" id="historyGrid">
        </div>
    </section>
</div>

<script src="{{ url_for('static', filename='js/generator.js') }}"></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/python.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/typescript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/java.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/cpp.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/go.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/xml.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/json.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/bash.min.js"></script>
<script>hljs.highlightAll();</script>
{% endblock %}